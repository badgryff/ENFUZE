<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ENFUZED: PHOTOCARDS</title>
<link href="https://fonts.googleapis.com/css2?family=Rubik+80s+Fade&display=swap" rel="stylesheet">
<style>
  body{margin:0;font-family:system-ui;background:#0a0000;color:#f5eaea;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;min-height:100vh;padding:24px;background:radial-gradient(circle at top, #1a0000, #000000 80%);overflow:hidden;}
  h1{font-family:'Rubik 80s Fade',cursive;font-size:36px;margin-bottom:10px;letter-spacing:1px;color:#ff3b3b;text-shadow:0 0 12px #ff0000;}
  button{background:#a20000;border:none;color:white;padding:10px 18px;border-radius:8px;font-weight:600;cursor:pointer;transition:opacity 0.3s;}
  button:hover{background:#cc0000;}
  button:disabled{opacity:0.5;cursor:not-allowed;}
  #stage{margin-top:20px;width:300px;height:450px;position:relative;perspective:1000px;}
  .card{width:100%;height:100%;border-radius:18px;transform-style:preserve-3d;transition:transform .8s;position:relative;box-shadow:0 15px 35px rgba(255,0,0,.3);z-index:2;}
  .card.flipped{transform:rotateY(180deg);} /* back side visible when flipped */
  .face{position:absolute;inset:0;backface-visibility:hidden;border-radius:18px;overflow:hidden;}
  /* FRONT is text-only */
  .front{transform:rotateY(0deg);position:relative;background:linear-gradient(135deg,#1a0000,#000);display:flex;align-items:center;justify-content:center;}
  .title{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:18px;}
  .title .member{font-weight:900;font-size:28px;letter-spacing:.5px;color:#ffd6d6;text-shadow:0 0 14px rgba(255,0,0,.6);} 
  .title .variant{margin-top:6px;font-weight:700;font-size:14px;color:#ff8c8c;letter-spacing:.08em}
  .back{transform:rotateY(180deg);position:relative;background:linear-gradient(135deg,#330000,#0a0000);display:flex;align-items:center;justify-content:center;}
  .back .logo{font-size:22px;font-weight:900;color:#ff3b3b;letter-spacing:1.5px;text-shadow:0 0 10px #ff0000;}
  .badge{position:absolute;top:10px;left:10px;padding:6px 10px;border-radius:999px;font-weight:700;font-size:13px;background:#330000;border:1px solid #ff4d4d;color:#fff;}
  .badge.signed{background:#4a002f;border-color:#ff6fb0;color:#ffe9f7;box-shadow:0 0 10px #ff0077;}
  .meta{position:absolute;bottom:12px;left:12px;right:12px;font-size:14px;text-align:center;font-weight:600;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);padding:6px 0;border-radius:10px;color:#fff;}
  #result{margin-top:20px;text-align:center;color:#f2b6b6;font-size:15px;}
  canvas#particles,canvas#confetti{position:fixed;inset:0;z-index:0;pointer-events:none;}
</style>
</head>
<body>
<h1>ENFUZED: PHOTOCARDS</h1>
<button id="openBtn">FUZE</button>
<canvas id="particles"></canvas>
<canvas id="confetti"></canvas>
<div id="stage">
  <div class="card" id="card">
    <div class="face front">
      <div id="rarBadge" class="badge">NORMAL</div>
      <div id="meta" class="meta"></div>
      <div class="title">
        <div id="memberName" class="member">â€”</div>
        <div id="variant" class="variant">â€“</div>
      </div>
    </div>
    <div class="face back">
      <div class="logo">ENFUZED</div>
    </div>
  </div>
</div>
<div id="result">No pulls yet.</div>
<script>
// ------------------------------------
// Members & Pool (placeholders inserted)
// ------------------------------------
const members = ["FRANZ","KAZSH","NAVI","INHU","DAMI","JOSHUA","ISHMI"];

const pool = [
  { name: "FRANZ â€” Normal",  img: "https://placehold.co/300x450/330000/ffffff?text=FRANZ+Normal",  rarity: "normal", weight: 999 },
  { name: "FRANZ â€” Signed",  img: "https://placehold.co/300x450/4a002f/ffffff?text=FRANZ+Signed",  rarity: "signed", weight: 1 },

  { name: "KAZSH â€” Normal",  img: "https://placehold.co/300x450/330000/ffffff?text=KAZSH+Normal",  rarity: "normal", weight: 999 },
  { name: "KAZSH â€” Signed",  img: "https://placehold.co/300x450/4a002f/ffffff?text=KAZSH+Signed",  rarity: "signed", weight: 1 },

  { name: "NAVI â€” Normal",   img: "https://placehold.co/300x450/330000/ffffff?text=NAVI+Normal",   rarity: "normal", weight: 999 },
  { name: "NAVI â€” Signed",   img: "https://placehold.co/300x450/4a002f/ffffff?text=NAVI+Signed",   rarity: "signed", weight: 1 },

  { name: "INHU â€” Normal",   img: "https://placehold.co/300x450/330000/ffffff?text=INHU+Normal",   rarity: "normal", weight: 999 },
  { name: "INHU â€” Signed",   img: "https://placehold.co/300x450/4a002f/ffffff?text=INHU+Signed",   rarity: "signed", weight: 1 },

  { name: "DAMI â€” Normal",   img: "https://placehold.co/300x450/330000/ffffff?text=DAMI+Normal",   rarity: "normal", weight: 999 },
  { name: "DAMI â€” Signed",   img: "https://placehold.co/300x450/4a002f/ffffff?text=DAMI+Signed",   rarity: "signed", weight: 1 },

  { name: "JOSHUA â€” Normal", img: "https://placehold.co/300x450/330000/ffffff?text=JOSHUA+Normal", rarity: "normal", weight: 999 },
  { name: "JOSHUA â€” Signed", img: "https://placehold.co/300x450/4a002f/ffffff?text=JOSHUA+Signed", rarity: "signed", weight: 1 },

  { name: "ISHMI â€” Normal",  img: "https://placehold.co/300x450/330000/ffffff?text=ISHMI+Normal",  rarity: "normal", weight: 999 },
  { name: "ISHMI â€” Signed",  img: "https://placehold.co/300x450/4a002f/ffffff?text=ISHMI+Signed",  rarity: "signed", weight: 1 }
];

// ------------------------------------
// Elements
// ------------------------------------
const card = document.getElementById('card');
const badge = document.getElementById('rarBadge');
const meta = document.getElementById('meta');
const result = document.getElementById('result');
const openBtn = document.getElementById('openBtn');
const memberName = document.getElementById('memberName');
const variant = document.getElementById('variant');
const confettiCanvas = document.getElementById('confetti');
const ctxConf = confettiCanvas.getContext('2d');
let wConf,hConf;function resizeConf(){wConf=confettiCanvas.width=window.innerWidth;hConf=confettiCanvas.height=window.innerHeight;}window.addEventListener('resize',resizeConf);resizeConf();

// ------------------------------------
// Cooldown with countdown label
// ------------------------------------
let canFuze = true;
openBtn.addEventListener('click', ()=>{ if(canFuze){ openBox(); cooldown(4); } });

function cooldown(seconds){
  canFuze=false;
  openBtn.disabled=true;
  let remaining = seconds;
  openBtn.textContent = `Wait ${remaining}s`;
  const countdown = setInterval(()=>{
    remaining--;
    if(remaining>0){ openBtn.textContent = `Wait ${remaining}s`; }
    else {
      clearInterval(countdown);
      canFuze=true;
      openBtn.disabled=false;
      openBtn.textContent='FUZE';
    }
  },1000);
}

// ------------------------------------
// Random selection: 0.1% per member for Signed
// ------------------------------------
function chooseCard(){
  const m = members[Math.floor(Math.random()*members.length)];
  const isSigned = Math.random() < 0.001; // 0.1% per member
  const type = isSigned ? 'Signed' : 'Normal';
  const picked = pool.find(p=>p.name.startsWith(m+" ") && p.name.includes(type));
  return { ...picked, isSigned, member:m, type };
}

// ------------------------------------
// Confetti
// ------------------------------------
function confettiBurst(big){
  const count = big?150:50;
  const pieces = Array.from({length:count},()=>({
    x:wConf/2+Math.random()*200-100,
    y:hConf/2,
    dx:(Math.random()-0.5)*8,
    dy:(Math.random()-0.5)*8,
    r:big?4+Math.random()*4:2+Math.random()*2,
    a:1
  }));
  let t=0;const id=setInterval(()=>{
    t++;ctxConf.clearRect(0,0,wConf,hConf);
    pieces.forEach(p=>{p.x+=p.dx;p.y+=p.dy;p.dy+=0.15;p.a-=0.01;ctxConf.globalAlpha=Math.max(p.a,0);ctxConf.fillStyle='rgba(255,'+(60+Math.random()*60)+','+(60+Math.random()*60)+',1)';ctxConf.beginPath();ctxConf.arc(p.x,p.y,p.r,0,Math.PI*2);ctxConf.fill();});
    if(t>150){clearInterval(id);ctxConf.clearRect(0,0,wConf,hConf);} 
  },16);
}

// ------------------------------------
// Open flow: flip BACK â†’ set content â†’ flip FRONT
// ------------------------------------
function openBox(){
  card.classList.add('flipped');
  const pick = chooseCard();
  setTimeout(()=>{
    badge.textContent = pick.rarity.toUpperCase();
    badge.className = 'badge' + (pick.isSigned ? ' signed' : '');
    meta.textContent = pick.name;
    memberName.textContent = pick.member;
    variant.textContent = pick.type.toUpperCase();

    card.classList.remove('flipped');

    if(pick.isSigned){
      result.innerHTML = `ðŸŽ‰ Congratulations! You received a <b>signed ${pick.name}</b>.<br>Screenshot the photocard to redeem your reward with <a href='https://instagram.com/enfuzed' target='_blank'>@enfuzed</a> on Instagram!`;
      confettiBurst(true);
    } else {
      result.textContent = `${pick.name} â€” Common`;
      confettiBurst(false);
    }
  }, 800);
}

// ------------------------------------
// Red Spark / Particle Animation
// ------------------------------------
const canvas = document.getElementById('particles');
const ctx = canvas.getContext('2d');
let w,h,particles;
function resize(){w=canvas.width=window.innerWidth;h=canvas.height=window.innerHeight;}
window.addEventListener('resize',resize);resize();

function initParticles(){
  particles = Array.from({length:80},()=>({
    x:Math.random()*w,
    y:Math.random()*h,
    r:Math.random()*2+1,
    dx:(Math.random()-0.5)*0.8,
    dy:(Math.random()-0.5)*0.8,
    life:Math.random()*100+100
  }));
}
initParticles();

function draw(){
  ctx.clearRect(0,0,w,h);
  ctx.fillStyle='rgba(255,60,60,0.7)';
  particles.forEach(p=>{
    ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fill();
    p.x+=p.dx;p.y+=p.dy;p.life-=1;
    if(p.x<0||p.x>w) p.dx*=-1;
    if(p.y<0||p.y>h) p.dy*=-1;
    if(p.life<0){p.x=Math.random()*w;p.y=Math.random()*h;p.life=Math.random()*100+100;}
  });
  requestAnimationFrame(draw);
}
draw();

// ------------------------------
// Minimal console test cases
// ------------------------------
(function runTests(){
  console.log('%cRunning basic testsâ€¦','color:#ff8080');
  console.assert(pool.length === members.length * 2, `Expected pool length ${members.length*2}, got ${pool.length}`);
  const normalsOk = pool.filter(p=>p.rarity==='normal').every(p=>p.weight===999);
  const signedOk  = pool.filter(p=>p.rarity==='signed').every(p=>p.weight===1);
  console.assert(normalsOk, 'All normal cards should have weight 999');
  console.assert(signedOk,  'All signed cards should have weight 1');
  let signed=0, trials=10000; for(let i=0;i<trials;i++){ if(chooseCard().isSigned) signed++; }
  const rate = signed/trials; console.assert(rate>0.004 && rate<0.012, `Signed rate ~0.007 expected, got ${rate}`);
  cooldown(1);
  console.assert(openBtn.disabled === true && /Wait\s*1s/.test(openBtn.textContent), 'Cooldown should disable button and show Wait 1s');
  setTimeout(()=>{
    console.assert(openBtn.disabled === false && openBtn.textContent==='FUZE', 'Cooldown should finish and re-enable button with FUZE label');
    console.log('%cTests completed.','color:#80ffb3');
  },1200);
})();
</script>
</body>
</html>
